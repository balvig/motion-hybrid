// Generated by CoffeeScript 1.7.1
(function() {
  window.MotionRails = (function() {
    var parseButton, parseFlash;

    function MotionRails() {}

    MotionRails.getParams = function() {
      var bridge, params;
      bridge = $('#motion_rails_bridge');
      params = {};
      params.title = bridge.find('h1').text();
      params.subtitle = bridge.find('h2').text();
      params.nav_bar_left_button = parseButton(bridge.find('#nav_bar_left_button'));
      params.nav_bar_right_button = parseButton(bridge.find('#nav_bar_right_button'));
      params.flash = parseFlash(bridge.find('.flash'));
      params.refreshable = $('[data-refreshable]').length > 0;
      return JSON.stringify(params);
    };

    parseButton = function(button) {
      if (button.length) {
        return {
          link: button.attr('href'),
          options: button.children().map(function() {
            return this.innerText;
          }).get()
        };
      }
    };

    parseFlash = function(flash) {
      if (flash.length) {
        return {
          title: flash.find('h3').text() || flash.text().trim(),
          subtitle: flash.find('p').text()
        };
      }
    };

    MotionRails.clicked = function(target, childIndex) {
      target = $("#" + target);
      if (childIndex) {
        target = target.children();
      }
      return target.get(childIndex || 0).click();
    };

    return MotionRails;

  })();

  jQuery(function() {
    var agent;
    agent = window.navigator.userAgent;
    if (agent.indexOf('iPhone') > 0 && agent.indexOf('Safari') < 0) {
      return document.location.href = 'motionrails://ready';
    } else {
      return $('body').addClass('motion_rails_dev');
    }
  });

}).call(this);
